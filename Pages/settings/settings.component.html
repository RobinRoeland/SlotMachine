
<div class="settings-container">
     <!-- Saved Indicator -->
    <div class="settings-actions">
    <span class="saved-indicator" [class.visible]="showSaved">
        ‚úì Settings saved
    </span>
    </div>

    <!-- General Settings Section -->
    <app-settings-section
    title="General Settings"
    description="Configure the general appearance and branding of the application."
    >
    <!-- Color Theme Subsection -->
    <div class="subsection">
        <h3 class="subsection-title">Color Theme</h3>
        <p class="subsection-description">Choose the color theme for the application.</p>
        <div class="theme-settings">
        <p class="helper-text">Select a color theme to change the appearance of the application.</p>
        
        <!-- Theme Options Grid -->
        <div class="theme-grid">
        <div 
            *ngFor="let theme of availableThemes"
            class="theme-option"
            [class.selected]="isThemeSelected(theme.name)"
            (click)="selectTheme(theme.name)"
        >
            <div class="theme-preview" [style.background]="theme.colors.previewGradient"></div>
            <div class="theme-name">{{ theme.displayName }}</div>
            <div class="selected-indicator">‚úì</div>
        </div>
        </div>
        </div>
    </div>

    <hr class="subsection-divider" />

    <!-- Company Branding Subsection -->
    <div class="subsection">
        <h3 class="subsection-title">Company Branding</h3>
        <p class="subsection-description">Customize the company logo displayed throughout the application.</p>
        <div class="logo-settings">
        <!-- Logo Type Toggle -->
        <div class="logo-type-toggle">
        <button 
            class="toggle-btn"
            [class.active]="selectedLogoType === 'regular'"
            (click)="switchLogoType('regular')"
        >
            üìÑ Regular Logo
        </button>
        <button 
            class="toggle-btn"
            [class.active]="selectedLogoType === 'small'"
            (click)="switchLogoType('small')"
        >
            üîò Small Logo
        </button>
        </div>

        <!-- Regular Logo Section -->
        <div *ngIf="selectedLogoType === 'regular'" class="logo-content">
        <p class="logo-usage-hint">This logo is displayed in the sidebar header (inside the expanded sidebar)</p>
        <!-- Current Logo Preview -->
        <div class="logo-preview-section">
        <h4>Current Logo</h4>
        <div class="logo-preview">
            <img [src]="settings.companyLogo" alt="Company Logo" />
        </div>
        </div>

        <!-- Logo Path Input -->
        <div class="logo-input-section">
        <h4>Logo Path</h4>
        <input 
            type="text" 
            class="logo-path-input"
            [value]="settings.companyLogo"
            (change)="onLogoPathChange($any($event.target).value)"
            placeholder="assets/images/your-logo.png"
        />
        <p class="helper-text">Enter the path to your logo file, or upload/select one below.</p>
        </div>

        <!-- File Upload -->
        <div class="logo-upload-section">
        <h4>Upload Custom Logo</h4>
        <label class="upload-button">
            <input 
            type="file" 
            accept="image/*"
            (change)="onLogoFileUpload($event)"
            hidden
            />
            <span>üìÅ Choose File</span>
        </label>
        <p class="helper-text">Upload a custom logo image (PNG, JPG, SVG, etc.)</p>
        </div>

        <!-- Preset Logos -->
        <div class="logo-presets-section">
        <h4>Or Select a Preset</h4>
        <div class="logo-grid">
            <div 
            *ngFor="let logo of presetLogos"
            class="logo-option"
            [class.selected]="isLogoSelected(logo)"
            (click)="selectPresetLogo(logo)"
            >
            <img [src]="logo" [alt]="logo" />
            <div class="selected-indicator">‚úì</div>
            </div>
        </div>
        </div>
        </div>

        <!-- Small Logo Section -->
        <div *ngIf="selectedLogoType === 'small'" class="logo-content">
        <p class="logo-usage-hint">This logo is displayed in the collapse/expand toggle button (top-left corner)</p>
        <!-- Current Small Logo Preview -->
        <div class="logo-preview-section">
        <h4>Current Small Logo</h4>
        <div class="logo-preview logo-preview-small">
            <img [src]="settings.companyLogoSmall" alt="Company Small Logo" />
        </div>
        </div>

        <!-- Small Logo Path Input -->
        <div class="logo-input-section">
        <h4>Small Logo Path</h4>
        <input 
            type="text" 
            class="logo-path-input"
            [value]="settings.companyLogoSmall"
            (change)="onLogoSmallPathChange($any($event.target).value)"
            placeholder="assets/images/your-small-logo.png"
        />
        <p class="helper-text">Enter the path to your small logo file, or upload/select one below.</p>
        </div>

        <!-- Small Logo File Upload -->
        <div class="logo-upload-section">
        <h4>Upload Custom Small Logo</h4>
        <label class="upload-button">
            <input 
            type="file" 
            accept="image/*"
            (change)="onLogoSmallFileUpload($event)"
            hidden
            />
            <span>üìÅ Choose File</span>
        </label>
        <p class="helper-text">Upload a custom small logo image (PNG, JPG, SVG, etc.)</p>
        </div>

        <!-- Preset Small Logos -->
        <div class="logo-presets-section">
        <h4>Or Select a Preset</h4>
        <div class="logo-grid">
            <div 
            *ngFor="let logo of presetLogosSmall"
            class="logo-option"
            [class.selected]="isLogoSmallSelected(logo)"
            (click)="selectPresetLogoSmall(logo)"
            >
            <img [src]="logo" [alt]="logo" />
            <div class="selected-indicator">‚úì</div>
            </div>
        </div>
        </div>
        </div>
        </div>
    </div>
    </app-settings-section>

    <!-- Game-Specific Settings (only shown when in game context) -->
    <ng-container *ngIf="shouldShowGameSettings()">
    <ng-container *ngFor="let game of games">
    <app-settings-section
        [title]="game.name + ' Settings'"
        [description]="'Configure settings specific to ' + game.name + '.'">
        
        <!-- Group settings by their group property -->
        <ng-container *ngFor="let group of getGameSettingsGroups(game)">
        <div class="game-settings-group" *ngIf="group">
            <h3 class="group-title">{{ group }}</h3>
            
            <ng-container *ngFor="let setting of getGameSettingsByGroup(game, group)">
            <!-- Toggle Setting -->
            <app-setting-item
                *ngIf="setting.type === 'toggle'"
                [title]="setting.label"
                [description]="setting.description">
                <app-toggle-switch
                [checked]="getSettingValue(setting.id)"
                (checkedChange)="onGameSettingChange(setting.id, $event)">
                </app-toggle-switch>
            </app-setting-item>
            </ng-container>
        </div>
        <hr class="group-divider" *ngIf="!isLastGroup(game, group)" />
        </ng-container>

        <!-- Legacy Arduino Control Setting -->
        <div class="legacy-settings">
        <hr class="group-divider" />
        <h3 class="group-title">Arduino Control</h3>
        <app-setting-item
            title="Enable Arduino Control"
            description="Allow triggering rolls via Arduino board connected through USB. Requires a supported browser (Chrome, Edge, Opera)."
            [class.disabled]="isMobile">
            <app-toggle-switch
            [checked]="settings.enableArduinoControl"
            [disabled]="isMobile"
            (checkedChange)="onEnableArduinoControlChange($event)">
            </app-toggle-switch>
        </app-setting-item>
        <div *ngIf="isMobile" class="arduino-disabled-note">
            ‚ö† Arduino control is not available on mobile devices
        </div>
        </div>

        <!-- Legacy Text Customization Settings -->
        <div class="legacy-settings">
        <hr class="group-divider" />
        <h3 class="group-title">Text Customization</h3>
        <p class="group-description">Customize what text and notifications appear during each game state.</p>
    <!-- Ready State Text -->
    <app-setting-item
        title="Ready to Roll State"
        description="Show text when the game is ready and waiting for you to click roll."
    >
        <app-toggle-switch
        [checked]="settings.showButtonTextRoll"
        (checkedChange)="onShowButtonTextRollChange($event)"
        ></app-toggle-switch>
    </app-setting-item>

    <div class="button-text-settings" *ngIf="settings.showButtonTextRoll">
        <div class="text-input-group">
        <label for="buttonTextRoll">Text to Display</label>
        <input 
            type="text" 
            id="buttonTextRoll"
            class="text-input"
            [value]="settings.buttonTextRoll"
            (blur)="onButtonTextRollChange($any($event.target).value)"
            placeholder="ROLL"
        />
        <p class="input-hint">üí° Appears on the button when you can click to start rolling</p>
        </div>
    </div>

    <hr class="button-text-divider" *ngIf="settings.showButtonTextRoll" />

    <!-- Rolling State Text -->
    <app-setting-item
        title="Currently Rolling State"
        description="Show text while the slot machine reels are actively spinning."
    >
        <app-toggle-switch
        [checked]="settings.showNotificationRolling"
        (checkedChange)="onShowNotificationRollingChange($event)"
        ></app-toggle-switch>
    </app-setting-item>

    <div class="button-text-settings" *ngIf="settings.showNotificationRolling">
        <div class="text-input-group">
        <label for="notificationRolling">Text to Display</label>
        <input 
            type="text" 
            id="notificationRolling"
            class="text-input"
            [value]="settings.notificationRolling"
            (blur)="onNotificationRollingChange($any($event.target).value)"
            placeholder="ROLLING..."
        />
        <p class="input-hint">üí° Appears while the reels are in motion (button is disabled)</p>
        </div>
    </div>

    <hr class="button-text-divider" *ngIf="settings.showNotificationRolling" />

    <!-- Win Notification -->
    <app-setting-item
        title="Win Result State"
        description="Show a notification when a winning combination is hit and a prize is won."
    >
        <app-toggle-switch
        [checked]="settings.showNotificationWin"
        (checkedChange)="onShowNotificationWinChange($event)"
        ></app-toggle-switch>
    </app-setting-item>

    <div class="button-text-settings" *ngIf="settings.showNotificationWin">
        <div class="text-input-group">
        <label for="notificationWin">Text to Display</label>
        <input 
            type="text" 
            id="notificationWin"
            class="text-input"
            [value]="settings.notificationWin"
            (blur)="onNotificationWinChange($any($event.target).value)"
            placeholder="YOU WON: {reward}"
        />
        <p class="input-hint">üí° Appears as a notification when you win. Use "{{ '{reward}' }}" to dynamically show the prize name.</p>
        </div>
    </div>

    <hr class="button-text-divider" *ngIf="settings.showNotificationWin" />

    <!-- After Roll Notification -->
    <app-setting-item
        title="After Roll Notification"
        description="Show a notification message after every roll is complete (win or loss)."
    >
        <app-toggle-switch
        [checked]="settings.showNotificationAfterRoll"
        (checkedChange)="onShowNotificationAfterRollChange($event)"
        ></app-toggle-switch>
    </app-setting-item>

    <div class="button-text-settings" *ngIf="settings.showNotificationAfterRoll">
        <div class="text-input-group">
        <label for="notificationAfterRoll">Notification Text</label>
        <input 
            type="text" 
            id="notificationAfterRoll"
            class="text-input"
            [value]="settings.notificationAfterRoll"
            (blur)="onNotificationAfterRollChange($any($event.target).value)"
            placeholder="Thanks for playing!"
        />
        <p class="input-hint">üí° Appears as a notification after every roll completes, regardless of the outcome</p>
        </div>
    </div>

    <hr class="button-text-divider" *ngIf="settings.showNotificationAfterRoll" />

    <!-- Arduino Instruction Text -->
    <app-setting-item
        title="Arduino Control State"
        description="Show instruction text when external Arduino hardware control is active."
        [disabled]="!settings.enableArduinoControl"
    >
        <app-toggle-switch
        [checked]="settings.showButtonTextArduino"
        [disabled]="!settings.enableArduinoControl"
        (checkedChange)="onShowButtonTextArduinoChange($event)"
        ></app-toggle-switch>
    </app-setting-item>

    <div class="button-text-settings" *ngIf="settings.showButtonTextArduino" [class.disabled]="!settings.enableArduinoControl">
        <div class="text-input-group">
        <label for="buttonTextArduino">Text to Display</label>
        <input 
            type="text" 
            id="buttonTextArduino"
            class="text-input"
            [value]="settings.buttonTextArduino"
            [disabled]="!settings.enableArduinoControl"
            (blur)="onButtonTextArduinoChange($any($event.target).value)"
            placeholder="Press the button to roll!"
        />
        <p class="input-hint">üí° Appears when waiting for Arduino physical button press</p>
        </div>
    </div>

    <div *ngIf="!settings.enableArduinoControl" class="arduino-disabled-note">
        ‚ö† Enable Arduino Control in settings above to customize this text
    </div>
        </div> <!-- Close legacy-settings -->
    </app-settings-section> <!-- Close game settings section -->
    </ng-container> <!-- Close ngFor games loop -->
    </ng-container> <!-- Close ngIf shouldShowGameSettings -->

    <!-- Data Management Section -->
    <app-settings-section
    title="Data Management"
    description="Export or import all application data including items, odds, prizes, and settings."
    >
    <div class="data-management-settings">
        <p class="helper-text">Use these options to backup or restore your complete slot machine configuration.</p>
        
        <div class="data-actions">
        <div class="action-item">
            <h4>Export All Data</h4>
            <p class="action-description">Download a complete backup of all items, odds, prizes, and settings to a JSON file.</p>
            <button class="export-button" (click)="exportAllData()">
            üì• Export All Data
            </button>
        </div>

        <div class="action-item">
            <h4>Import All Data</h4>
            <p class="action-description">Restore a complete backup from a JSON file. This will replace all current data.</p>
            <button class="import-button" (click)="importAllData()">
            üì§ Import All Data
            </button>
        </div>
        </div>

        <div class="data-warning">
        ‚ö†Ô∏è <strong>Warning:</strong> Importing data will completely replace your current items, odds, prizes, and settings. Make sure to export your current data first if you want to keep it.
        </div>
    </div>
    </app-settings-section>

    <!-- Tutorial Section -->
    <!--<app-settings-section
    title="Help & Tutorial"
    description="Access the interactive tutorial to learn how to use the application."
    >
    <app-setting-item
        title="Show Tutorial"
        description="Reopen the getting started tutorial that guides you through adding items and prizes."
    >
        <button class="tutorial-button" (click)="showTutorial()">
        üìö Start Tutorial
        </button>
    </app-setting-item>
    </app-settings-section>
</div>-->

<!-- Tutorial Modal -->
<!--<tutorial-modal *ngIf="showTutorialModal" (close)="closeTutorial()"></tutorial-modal>-->
